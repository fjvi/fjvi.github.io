<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, minimal-ui">
  <title>Bookmarks</title>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
  <div id="content"></div>
  <script>
    (async()=>{
      if(location.protocol!=='https:'&&location.hostname!=='localhost'){
        return document.getElementById('content').textContent='请使用 HTTPS 或 localhost';
      }
      let url=location.hash.slice(1)||location.search.slice(1)||'sq/';
      async function fetchMd(u){
        let r=await fetch(u);
        if(r.status===404) throw {code:404, url:u};
        if(!r.ok) throw new Error(r.status);
        return r.text();
      }
      try{
        let txt;
        try{
          txt=await fetchMd(url);
        }catch(e){
          if(e.code===404){
            let alt=url.endsWith('/')?url+'README.md':url+'/README.md';
            txt=await fetchMd(alt);
          } else throw e;
        }
        let first=txt.split('\n')[0].trim();
        document.title=first.startsWith('#')?first.replace(/^#+\s*/, ''):url;
        document.getElementById('content').innerHTML=marked.parse(txt);
      }catch(e){
        let el=document.getElementById('err');
        el.hidden=false;
        el.textContent=e.code===404?`未找到文档 (${e.url})`:'加载失败: '+e.message;
      }
    })();
  </script>
</body>
</html>
