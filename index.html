<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Bookmarks</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
    <div id="content"></div>

    <script>
    (function() {
        const DEFAULT_PATH = '/sq';
        
        function getRequestPath() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('path') || DEFAULT_PATH;
        }

        function updateTitle(firstLine) {
            if (firstLine.startsWith('#')) {
                const titleText = firstLine.replace(/^#+\s*/, '').trim();
                document.title = titleText + ' - ' + document.title;
            }
        }

        async function loadContent() {
            const path = getRequestPath();
            const contentEl = document.getElementById("content");
            
            try {
                const response = await fetch(path);
                if (!response.ok) {
                    contentEl.innerHTML = "内容加载失败，请检查路径是否正确";
                    return;
                }
                
                const text = await response.text();
                const firstLine = text.split('\n')[0];
                
                updateTitle(firstLine);
                contentEl.innerHTML = marked(text);
                
                // 更新URL但不刷新页面
                history.pushState({}, '', `?path=${encodeURIComponent(path)}`);
                
            } catch (error) {
                console.error('加载失败:', error);
                contentEl.innerHTML = "网络错误，无法加载内容";
            }
        }

        // 处理浏览器前进/后退
        window.addEventListener('popstate', loadContent);
        
        // 初始加载
        loadContent();
    })();
    </script>
</body>
</html>
